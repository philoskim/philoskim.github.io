<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><title>4&nbsp;Functional Programming</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Clojure Memo</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="why-clojure.html" class="tocviewlink" data-pltdoc="x">Why Clojure?</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="var.html" class="tocviewlink" data-pltdoc="x">Vars</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="recursions.html" class="tocviewlink" data-pltdoc="x">Recursions</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Functional Programming</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="tips.html" class="tocviewlink" data-pltdoc="x">Tips</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>4&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Functional Programming</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">4.1&nbsp;</td><td><a href="#%28part._.Middleware_pattern%29" class="tocviewlink" data-pltdoc="x">Middleware pattern</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">4.1<tt>&nbsp;</tt></span><a href="#%28part._.Middleware_pattern%29" class="tocsubseclink" data-pltdoc="x">Middleware pattern</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="recursions.html" title="backward to &quot;3 Recursions&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Clojure Memo&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="tips.html" title="forward to &quot;5 Tips&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>4<tt>&nbsp;</tt><a name="(part._functional-programming)"></a>Functional Programming</h3><h4>4.1<tt>&nbsp;</tt><a name="(part._.Middleware_pattern)"></a>Middleware pattern</h4><p>&#54632;&#49688;&#54805; &#54532;&#47196;&#44536;&#47000;&#48141; &#44592;&#48277; &#51473;&#50640; middleware pattern&#51060; &#51080;&#45796;. Ring &#46972;&#51060;&#48652;&#47084;&#47532;&#50640;&#49436; &#49324;&#50857;&#46104;&#44256; &#51080;&#45716;
&#51060; &#54056;&#53556;&#51008; &#45796;&#47480; &#46972;&#51060;&#48652;&#47084;&#47532;&#46308;&#50640;&#49436;&#46020; &#47566;&#51060; &#48380; &#49688; &#51080;&#51012; &#51221;&#46020;&#47196; &#54632;&#49688;&#54805; &#54532;&#47196;&#44536;&#47000;&#48141;&#50640;&#49436; &#55124;&#55176; &#50416;&#51060;&#45716;
&#44592;&#48277;&#51060;&#45796;. &#51060; &#54056;&#53556;&#50640; &#45824;&#54644; &#48516;&#49437;&#54644; &#48372;&#44192;&#45796;.</p><p>Ring&#51032; middleware &#54056;&#53556;&#51008; handler&#50752; middleware&#46972;&#45716; &#54632;&#49688;&#46308;&#51032; &#44208;&#54633;&#51004;&#47196; &#51060;&#47336;&#50612;&#51256; &#51080;&#45796;. &#44033;&#44033;&#51032;
&#53945;&#51669;&#51012; &#50508;&#50500; &#48372;&#51088;.</p><p>&#54648;&#46308;&#47084;&#51032; &#53945;&#51669;&#48512;&#53552; &#48372;&#51088;.</p><ul><li><p>&#54648;&#46308;&#47084; &#54632;&#49688; &#44061;&#52404;&#45716; &#54616;&#45208;&#51032; request map &#51064;&#49688;&#47484; &#48155;&#50500; response map&#51012; &#48152;&#54872;&#54620;&#45796;.</p></li></ul><p>&#48120;&#46308;&#50920;&#50612;&#51032; &#53945;&#51669;&#51008; &#45796;&#51020;&#44284; &#44057;&#45796;.</p><ul><li><p>middleware&#45716; &#54620;&#44060; &#51060;&#49345;&#51032; &#51064;&#49688;&#47484; &#48155;&#51012; &#49688; &#51080;&#51648;&#47564;, &#52395;&#48264;&#51704; &#51064;&#49688;&#45716; &#48152;&#46300;&#49884; &#54648;&#46308;&#47084; &#54632;&#49688;
&#44061;&#52404;&#51060;&#50612;&#50556; &#54620;&#45796;. &#44536;&#47532;&#44256; &#54648;&#46308;&#47084; &#54632;&#49688; &#44061;&#52404;&#47484; &#48152;&#54872;&#54644;&#50556; &#54620;&#45796;.</p></li><li><p>middleware&#45716; &#54648;&#46308;&#47084; &#54632;&#49688; &#44061;&#52404;&#47484; &#51064;&#49688;&#47196; &#48155;&#50500; &#49892;&#54665;&#49884;&#53416; &#54980;, &#49352;&#47196;&#50868; &#54648;&#46308;&#47084; &#54632;&#49688; &#44061;&#52404;&#47484;
&#49373;&#49457;&#54644; &#48152;&#54872;&#54616;&#45716; &#50669;&#54624;&#51012; &#49688;&#54665;&#54620;&#45796;.</p></li></ul><p>&#49892;&#51228; &#50696;&#51228; &#53076;&#46300;&#47484; &#48372;&#51088;. &#52280;&#44256;&#47196;, Ring&#50640;&#49436;&#45716; middleware&#51032; &#51060;&#47492;&#51012; wrap&#51004;&#47196; &#49884;&#51089;&#54616;&#45716; &#44288;&#54665;&#51060;
&#51080;&#45796;. &#48150;&#50640; &#51080;&#45716; &#48120;&#46308;&#50920;&#50612; &#54632;&#49688;&#44032;, &#49356;&#46300;&#50948;&#52824;&#52376;&#47100;, &#50504;&#50640; &#51080;&#45716; &#54648;&#46308;&#47084; &#54632;&#49688;&#47484; &#44048;&#49912;&#44256; &#51080;&#45716; &#45936;&#49436;
&#48708;&#47215;&#46108; &#47568;&#51060;&#45796;.</p><p><pre class="codeblock">(def app                              ;           Response
  (-&gt; handler                         ;    ^         |
    (wrap-content-type "text/html")   ;    |         |
    (wrap-keyword-params)             ;    |         |
    (wrap-params)))                   ;    |         v
                                      ; Request</pre></p><p>&#50948;&#51032; &#50416;&#47112;&#46377; &#47588;&#53356;&#47196; -&gt;&#45716; &#45796;&#51020;&#44284; &#44057;&#51060; &#54869;&#51109;&#46108;&#45796;.</p><p><pre class="codeblock">(wrap-params (wrap-keyword-params (wrap-content-type handler
                                                     "text/html")))</pre></p><p>&#50416;&#47112;&#46377; &#47588;&#53356;&#47196; -&gt; &#50504;&#50640;&#49436;&#45716; handler&#44032; &#47592; &#52376;&#51020;&#50640; &#50724;&#51648;&#47564;, &#49892;&#51228; &#52376;&#47532;&#49884; request map&#51012; &#52376;&#51020;&#51004;&#47196;
&#48155;&#45716; &#44163;&#51008; &#44144;&#44984;&#47196; wrap-params(&#51328; &#45908; &#51221;&#54869;&#55176;&#45716;, wrap-params &#54632;&#49688;&#44032; &#49892;&#54665;&#46108; &#54980; &#48152;&#54872;&#54616;&#45716; '&#54648;&#46308;&#47084;
&#54632;&#49688;')&#51060;&#45796;. &#44536;&#47000;&#49436; &#49892;&#51228; &#52376;&#47532;&#45716; &#45796;&#51020;&#44284; &#44057;&#51008; &#55120;&#47492;&#51012; &#53440;&#44172; &#46108;&#45796;.</p><p><a name="(idx._(gentag._0))"></a><span class="stt">&lt;&#52376;&#47532; Flow&gt;</span>
<pre class="descblock">wrap-params      wrap-keyword-params   wrap-content-params   handler
--------------------------------------------------------------------------
request 1&#52264;  --&gt; request 2&#52264;         -&gt; request 3&#52264;       --&gt; request 4&#52264;
response 4&#52264; &lt;-- response 3&#52264;        &lt;- response 2&#52264;      &lt;-- response 1&#52264;</pre></p><p>&#50948;&#51032; &#53076;&#46300; &#50696;&#51228;&#50640;&#49436; wrap-params&#45208; wrap-keyword-params &#54632;&#49688;&#51032; &#44396;&#54788;&#46108; &#53076;&#46300;&#47484; &#48400;&#50556; &#51204;&#52404;&#51032;
&#55120;&#47492;&#51060; &#51228;&#45824;&#47196; &#51060;&#54644;&#46112; &#49688; &#51080;&#45716;&#45936;, &#44033;&#44033;&#51032; &#54632;&#49688;&#51032; &#53076;&#46300;&#51032; &#44396;&#52404;&#51201;&#51064; &#44396;&#54788; &#45236;&#50857;&#51060; &#51204;&#48152;&#51201;&#51064; &#54056;&#53556;&#51012;
&#54028;&#50501;&#54616;&#44592;&#50640;&#45716; &#45320;&#47924; &#48373;&#51105;&#54616;&#45796;. &#44536;&#47000;&#49436; &#50500;&#47000;&#50640; &#55120;&#47492;&#51032; &#44264;&#44201;&#47564;&#51012; &#54028;&#50501;&#54624; &#49688; &#51080;&#46020;&#47197; &#53076;&#46300;&#47484; &#44036;&#45800;&#54616;&#44172;
&#51649;&#51217; &#51676;&#48372;&#50520;&#45796;.</p><p><pre class="codeblock">(def counter (atom 0))

;; &#54532;&#47196;&#44536;&#47016;&#51032; &#49892;&#54665; &#49692;&#49436;&#47484; &#47749;&#49884;&#51201;&#51004;&#47196; &#54364;&#49884;&#54616;&#44592; &#50948;&#54620; &#48372;&#51312; &#54632;&#49688;.
(defn inc-counter []
  (swap! counter inc))

(def handler-1
  (fn [req] ; handler-1
    (let [req' (assoc req :handler-1-req (inc-counter))
          _    (println "handler-1 req:" req')
          res  (assoc req' :handler-1-res (inc-counter))
          _    (println "handler-1 res:" res)]
      res)))

;; middleware-1
(defn wrap-1 [handler-1]
  ;; handler-2
  (fn [req]
    (let [req' (assoc req :handler-2-req (inc-counter))
          _    (println "handler-2 req:" req')
          res  (handler-1 req')
          res' (assoc res :handler-2-res (inc-counter))
          _    (println "handler-2 res:" res')]
      res') ))

;; middleware-2
(defn wrap-2 [handler-2]
  ;; handler-3
  (fn [req]
    (let [req' (assoc req :handler-3-req (inc-counter))
          _    (println "handler-3 req:" req')
          res  (handler-2 req')
          res' (assoc res :handler-3-res (inc-counter))
          _    (println "handler-3 res:" res')]
      res') ))</pre></p><p>&#50948;&#50640;&#49436; &#51456;&#48708;&#54620; middleware&#46308;&#44284; handler&#46308;&#51012; Ring &#54805;&#49885;&#51004;&#47196; &#54840;&#52636;&#54616;&#47732; &#45796;&#51020;&#44284; &#44057;&#45796;.</p><p><pre class="codeblock">(def app
  (-&gt; handler-1
    (wrap-1)
    (wrap-2)))

(app {})
; &gt;&gt; handler-3 req: {:handler-3-req 1}
; &gt;&gt; handler-2 req: {:handler-3-req 1, :handler-2-req 2}
; &gt;&gt; handler-1 req: {:handler-3-req 1, :handler-2-req 2, :handler-1-req 3}
; &gt;&gt; handler-1 res: {:handler-3-req 1, :handler-2-req 2, :handler-1-req 3,
;                    :handler-1-res 4}
; &gt;&gt; handler-2 res: {:handler-3-req 1, :handler-2-req 2, :handler-1-req 3,
;                    :handler-1-res 4, :handler-2-res 5}
; &gt;&gt; handler-3 res: {:handler-3-req 1, :handler-2-req 2, :handler-1-req 3,
;                    :handler-1-res 4, :handler-2-res 5, :handler-3-res 6}
; =&gt; {:handler-3-req 1, :handler-2-req 2, :handler-1-req 3,
;     :handler-1-res 4, :handler-2-res 5, :handler-3-res 6}</pre></p><p>&#50948;&#51032; &#50416;&#47112;&#46377; &#47588;&#53356;&#47196;&#44032; &#54869;&#51109;&#46108; &#49892;&#51228; &#47784;&#49845;&#51012; &#53076;&#46300;&#47196; &#51116;&#44396;&#49457;&#54616;&#47732; &#45796;&#51020;&#44284; &#44057;&#51008;&#45936;, &#53076;&#46300;&#44032; &#50557;&#44036;
&#48373;&#51105;&#54616;&#44172; &#48372;&#51060;&#51648;&#47564;, &#44536; &#50504;&#50640;&#49436; &#45824;&#45800;&#54620; &#51068;&#51012; &#54616;&#44256; &#51080;&#51648;&#45716; &#50506;&#51008; &#53076;&#46300;&#51060;&#48064;&#47196;, &#51312;&#44552;&#47564; &#51064;&#45236;&#49900;&#51012; &#44054;&#44256;
&#48516;&#49437;&#54616;&#47732; &#50612;&#47157;&#51648; &#50506;&#44172; &#51060;&#54644;&#54624; &#49688; &#51080;&#51012; &#44163;&#51060;&#45796;. &#44208;&#44397; &#50948;&#51032; app&#51060;&#46972;&#45716; &#49900;&#48380;&#51008; &#50500;&#47000;&#51032; ';;
handler-3' &#51060;&#46972;&#44256; &#54364;&#49884;&#54620; &#54632;&#49688; &#44061;&#52404; &#51204;&#52404;&#44032; &#46104;&#44256;, &#45796;&#51020; &#50696;&#51228;&#51032; (1)&#51032; &#48708;&#50612;&#51080;&#45716; &#47605; {}&#51060; &#44536;
&#51064;&#51088;&#47196; &#46308;&#50612;&#44032;&#44172; &#46108;&#45796;.</p><p><pre class="codeblock">(reset! counter 0)

 ;; handler-3
((fn [req] ; (2)
              ;; request 1&#52264; &#48320;&#44221;
   (let [req' (assoc req :handler-3-req (inc-counter))
         _    (println "handler-3 req:" req')
               ;; handler-2
         res  ((fn [req] ; (4)
                            ;; request 2&#52264; &#48320;&#44221;
                 (let [req' (assoc req :handler-2-req (inc-counter))
                       _    (println "handler-2 req:" req')
                             ;; handler-1
                       res  ((fn [req] ; (6)
                                          ;; request 3&#52264; &#48320;&#44221;
                               (let [req' (assoc req :handler-1-req
                                                 (inc-counter))
                                      _   (println "handler-1 req:" req')
                                          ;; response 1&#52264; &#48320;&#44221;
                                     res  (assoc req' :handler-1-res
                                                 (inc-counter))
                                     _    (println "handler-1 res:" res)]
                                 res))
                               req') ; (5)
                            ;; response 2&#52264; &#48320;&#44221;
                       res' (assoc res :handler-2-res (inc-counter))
                       _    (println "handler-2 res:" res')]
                   res'))
               req') ; (3)
               ;; response 3&#52264; &#48320;&#44221;
          res' (assoc res :handler-3-res (inc-counter))
          _   (println "handler-3 res:" res')]
     res'))
 {}) ; (1)
; &gt;&gt; handler-3 req: {:handler-1-req 1}
; &gt;&gt; handler-2 req: {:handler-1-req 1, :handler-3-req 2}
; &gt;&gt; handler-1 req: {:handler-1-req 1, :handler-3-req 2, :handler-2-req 3}
; &gt;&gt; handler-1 res: {:handler-1-req 1, :handler-3-req 2, :handler-2-req 3,
;                    :handler-1-res 4}
; &gt;&gt; handler-2 res: {:handler-1-req 1, :handler-3-req 2, :handler-2-req 3,
;                    :handler-1-res 4, :handler-2-res 5}
; &gt;&gt; handler-3 res: {:handler-1-req 1, :handler-3-req 2, :handler-2-req 3,
;                    :handler-1-res 4, :handler-2-res 5, :handler-3-res 6}
; =&gt; {:handler-3-req 1, :handler-2-req 2, :handler-1-req 3,
;     :handler-1-res 4, :handler-2-res 5, :handler-3-res 6}</pre></p><ul><li><p>(1)&#51032; &#48708;&#50612; &#51080;&#45716; &#47605;&#51060; (2)&#51032; req &#51064;&#51088;&#47196; &#46308;&#50612;&#44036;&#45796;.</p></li><li><p>(3)&#51032; req'&#44032; (4)&#51032; req &#51064;&#51088;&#47196; &#46308;&#50612;&#44036;&#45796;.</p></li><li><p>(5)&#51032; req'&#44032; (6)&#51032; req &#51064;&#51088;&#47196; &#46308;&#50612;&#44036;&#45796;.</p></li></ul><p>&#44208;&#47200;&#51201;&#51004;&#47196; &#48372;&#47732;, &#50696;&#51204; &#53076;&#46300;&#50640;&#49436; app &#49900;&#48380;&#51008; &#54632;&#49688; &#44061;&#52404;&#47484; &#44032;&#47532;&#53416;&#45796;. &#51060; &#54632;&#49688; &#44061;&#52404;&#45716; (def app
...)&#50640;&#49436; &#51221;&#51032;&#47564; &#46104;&#50632;&#51012; &#49104; &#54840;&#52636;&#46104;&#51648;&#45716; &#50506;&#51008; &#49345;&#53468;&#51060;&#48064;&#47196;, &#54840;&#52636;&#54616;&#47140;&#47732; (app {...})&#50752; &#44057;&#51060; &#54644;
&#51452;&#50612;&#50556; &#54616;&#45716;&#45936;, &#51060;&#47088; &#49885;&#51032; &#49892;&#51228; &#54840;&#52636;&#51008; Ring&#51060; &#50508;&#50500;&#49436; &#54644; &#51452;&#44172; &#46108;&#45796;.</p><p>&#44208;&#44397; &#48120;&#46308;&#50920;&#50612; &#54056;&#53556;&#51032; &#54645;&#49900;&#51008;, &#54632;&#49688;&#54805; &#54532;&#47196;&#44536;&#47000;&#48141;&#50640;&#49436; &#54632;&#49688; &#44061;&#52404;&#47484; 1&#44553; &#44061;&#52404;&#47196; &#52376;&#47532;&#54616;&#44172; &#54644; &#51452;&#45716;
&#44592;&#45733;&#51012; &#49901;&#48516; &#54876;&#50857;&#54620; &#44163;&#51060;&#45796;.  &#54632;&#49688; &#44061;&#52404; &#51088;&#52404;&#47484; '&#51064;&#51088;'&#47196; &#51204;&#45804;&#54616;&#44256;, &#54632;&#49688; &#44061;&#52404; &#51088;&#52404;&#47484;
'&#47532;&#53556;&#44050;'&#51004;&#47196; &#48152;&#54872;&#54616;&#45716;, &#54632;&#49688;&#54805; &#54532;&#47196;&#44536;&#47000;&#48141; &#48169;&#49885;&#51012; &#51201;&#44537; &#52292;&#50857;&#54616;&#44256; &#51080;&#45716; &#44163;&#51060;&#46972; &#48380; &#49688; &#51080;&#45796;.</p><p>&#50864;&#47532;&#45716; &#54632;&#49688;&#44032; 1&#44553; &#44061;&#52404;&#44032; &#50500;&#45772; &#50616;&#50612;&#50640; &#44600;&#46308;&#50612;&#51256; &#51080;&#50612;&#49436;, &#51060;&#47088; &#48169;&#49885;&#51012; &#45000;&#50640;&#46020; &#44984;&#51648; &#47803;&#54620; &#44163;&#51068;
&#49104;, &#51061;&#49689;&#54644;&#51648;&#47732; &#51201;&#44537; &#54876;&#50857;&#54644; &#48380; &#47564;&#54620; &#44032;&#52824;&#44032; &#51080;&#45716; &#44163;&#51004;&#47196; &#48372;&#51064;&#45796;. &#51060;&#47084;&#54620; &#54056;&#53556;&#51012; &#48516;&#49437;&#54616;&#47732;&#49436;,
Heidegger&#44032; &#51060;&#50556;&#44592;&#54620; '&#50616;&#50612;&#45716; &#51316;&#51116;&#51032; &#51665;&#51060;&#45796;' &#46972;&#45716; &#47568;&#51060; &#49352;&#49340; &#46496;&#50724;&#47480;&#45796;. &#50616;&#50612;&#44032; &#49324;&#44256; &#48169;&#49885;&#47560;&#51200;
&#51648;&#48176;&#54624; &#49688; &#51080;&#45796;&#45716; &#49324;&#49892;&#51060; &#54620;&#54200;&#51004;&#47196;&#45716; &#46160;&#47140;&#50864;&#47732;&#49436;, &#46041;&#49884;&#50640; &#51060; &#48317;&#51012; &#44648;&#44256; &#54632;&#49688; &#44061;&#52404;&#47484; 1&#44553; &#44061;&#52404;&#47196;
&#49324;&#50857;&#54624; &#49688; &#51080;&#45796;&#45716; &#44163;&#51012; &#51068;&#44648;&#50892;&#51456; &#52380;&#51116; &#54532;&#47196;&#44536;&#47000;&#47672;&#46308;&#50640;&#44172; &#44221;&#51032;&#47484; &#54364;&#54616;&#44256; &#49910;&#45796;.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="recursions.html" title="backward to &quot;3 Recursions&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Clojure Memo&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="tips.html" title="forward to &quot;5 Tips&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>